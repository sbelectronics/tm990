( smbaker - run this if need to unmute the amplifier )
61438 CONSTANT MUT
1 MUT C!

( remainder authored by anthropic claude-3.5-sonnet )

( Constants for AY-3-8910 registers )
0 CONSTANT CHANNEL_A_FINE_TUNE
1 CONSTANT CHANNEL_A_COARSE_TUNE
7 CONSTANT MIXER_CONTROL
8 CONSTANT CHANNEL_A_VOLUME

( Correct tone values for AY-3-8910 )
427 CONSTANT C4_TONE
380 CONSTANT D4_TONE
339 CONSTANT E4_TONE
320 CONSTANT F4_TONE
285 CONSTANT G4_TONE

( Constants for AY-3-8910 memory addresses )
61434 CONSTANT AY_REG_SELECT
61436 CONSTANT AY_REG_WRITE

( Custom delay routine for 3MHz system )
: MS ( ms -- )
    4 * 0 DO I DROP LOOP ;

( Helper word to write to AY-3-8910 )
: AY! ( value register -- )
    AY_REG_SELECT C!
    AY_REG_WRITE C! ;

( Helper words )
: SET-TONE ( tone -- )
    DUP 255 AND CHANNEL_A_FINE_TUNE AY!
    256 / CHANNEL_A_COARSE_TUNE AY! ;

: PLAY-NOTE ( tone duration -- )
    SWAP SET-TONE
    254 MIXER_CONTROL AY!  ( Enable tone on channel A )
    15 CHANNEL_A_VOLUME AY!
    MS
    0 CHANNEL_A_VOLUME AY! ;

: PAUSE ( duration -- )
    MS ;

( Main melody )
: MARY-HAD-A-LITTLE-LAMB
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    C4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    E4_TONE 1000 PLAY-NOTE 200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 1000 PLAY-NOTE 200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    G4_TONE 500 PLAY-NOTE  200 PAUSE
    G4_TONE 1000 PLAY-NOTE 200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    C4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    E4_TONE 500 PLAY-NOTE  200 PAUSE
    D4_TONE 500 PLAY-NOTE  200 PAUSE
    C4_TONE 1000 PLAY-NOTE ;

( Play the melody )
: PLAY-MELODY
    MARY-HAD-A-LITTLE-LAMB ;

PLAY-MELODY
